<!DOCTYPE html>
<html lang="hu">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>My map</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tailwindcss/ui@latest/dist/tailwind-ui.min.css">

    <!-- <script src="https://tuleloverseny.hu/graphics/leaflet/leaflet-control-custom/Leaflet.Control.Custom.js"></script> -->
    <script>
        (function (window, document, undefined) {
            L.Control.Custom = L.Control.extend({
                version: '1.0.1',
                container: null,
                onAdd: function (map) {
                    this.container = L.DomUtil.create('div');
                    this.container.id = this.options.id;
                    this.container.title = this.options.title;
                    this.container.className = this.options.classes;
                    this.container.innerHTML = this.options.content;
                    for (var option in this.options.style) {
                        this.container.style[option] = this.options.style[option];
                    }
                    for (var data in this.options.datas) {
                        this.container.dataset[data] = this.options.datas[data];
                    }
                    /* Prevent click events propagation to map */
                    L.DomEvent.disableClickPropagation(this.container);
                    /* Prevent right click event propagation to map */
                    L.DomEvent.on(this.container, 'contextmenu', function (ev) {
                        L.DomEvent.stopPropagation(ev);
                    });
                    /* Prevent scroll events propagation to map when cursor on the div */
                    L.DomEvent.disableScrollPropagation(this.container);
                    for (var event in this.options.events) {
                        L.DomEvent.on(this.container, event, this.options.events[event], this.container);
                    }
                    return this.container;
                },
                onRemove: function (map) {
                    for (var event in this.options.events) {
                        L.DomEvent.off(this.container, event, this.options.events[event], this.container);
                    }
                },
            });
            L.control.custom = function (options) {
                return new L.Control.Custom(options);
            };
        }(window, document));
    </script>

    <style>
      html, body {
        height: 100%;
        padding: 0;
        margin: 0;
      }
      #map {
        width: 100%;
        height: 100%;
      }
      .leaflet-map-pane{
         z-index: 100;
      }
      .leaflet-control-coordinates .uiElement .labelFirst {
         margin-right: 0px;
      }
    </style>
  </head>
  <body>
<div id="map"></div>
<script>
    var tuUrl='https://{s}.map.turistautak.hu/tiles/turistautak/{z}/{x}/{y}.png';
    var tuAttrib='&copy; <a href="http://turistautak.hu">Turistautak.hu</a>';
    var tuSubDomains = 'abcd';
    var tuMaxZoom = 21;
    var tu = new L.TileLayer(tuUrl, {attribution: tuAttrib}, {attribution: tuAttrib}, {subdomains: tuSubDomains}, {maxZoom: tuMaxZoom});
    var otmUrl='https://a.tile.opentopomap.org/{z}/{x}/{y}.png';
    var otmAttrib='&copy; <a href="https://www.opentopomap.org/copyright">OpenTopoMap</a> contributors';
    var otm = new L.TileLayer(otmUrl, {attribution: otmAttrib});
    var osmUrl='http://{s}.tile.osm.org/{z}/{x}/{y}.png';
    var osmAttrib='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors';
    var osm = new L.TileLayer(osmUrl, {attribution: osmAttrib});
    var tfUrl='http://tile.thunderforest.com/landscape/{z}/{x}/{y}.png?apikey=c00a97c42289402f8e05561fb3244e47';
    var tfAttrib='&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors';
    var tf = new L.TileLayer(tfUrl, {attribution: tfAttrib});
    var tfpUrl='http://tile.thunderforest.com/pioneer/{z}/{x}/{y}.png?apikey=c00a97c42289402f8e05561fb3244e47';
    var tfpAttrib='&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors';
    var tfp = new L.TileLayer(tfpUrl, {attribution: tfpAttrib});
    var tfmUrl='http://tile.thunderforest.com/mobile-atlas/{z}/{x}/{y}.png?apikey=c00a97c42289402f8e05561fb3244e47';
    var tfmAttrib='&copy; <a href="http://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors';
    var tfm = new L.TileLayer(tfmUrl, {attribution: tfmAttrib});
    var esrisatUrl='https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}';
    var esrisatAttrib='Tiles &copy; Esri &mdash; Source: Esri, Earthstar Geographics';
    var esrisat = new L.TileLayer(esrisatUrl, {attribution: esrisatAttrib});
    var esritUrl='https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}';
    var esritAttrib='Tiles &copy; Esri &mdash; Source: Esri, Earthstar Geographics';
    var esrit = new L.TileLayer(esritUrl, {attribution: esritAttrib});
    var esrisUrl='https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}';
    var esrisAttrib='Tiles &copy; Esri &mdash; Source: Esri, Earthstar Geographics';
    var esris = new L.TileLayer(esrisUrl, {attribution: esrisAttrib});
    var cycloUrl='https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png';
    var cycloAttrib='&copy; <a href="https://www.cyclosm.org">CyclOSM</a>, OpenStreetMap contributors';
    var cyclo = new L.TileLayer(cycloUrl, {attribution: cycloAttrib});
    var tpocUrl='http://sgx.geodatenzentrum.de/wmts_topplus_open/tile/1.0.0/web/default/WEBMERCATOR/{z}/{y}/{x}.png';
    var tpocAttrib='Map data: &copy; <a href="http://www.govdata.de/dl-de/by-2-0">dl-de/by-2-0</a>';
    var tpoc = new L.TileLayer(tpocUrl, {attribution: tpocAttrib});
    var tpogUrl='http://sgx.geodatenzentrum.de/wmts_topplus_open/tile/1.0.0/web_grau/default/WEBMERCATOR/{z}/{y}/{x}.png';
    var tpogAttrib='Map data: &copy; <a href="http://www.govdata.de/dl-de/by-2-0">dl-de/by-2-0</a>';
    var tpog = new L.TileLayer(tpogUrl, {attribution: tpogAttrib});
    var cdblUrl='https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png';
    var cdblAttrib='&copy; <a href="https://carto.com/">CARTO</a>';
    var cdbl = new L.TileLayer(cdblUrl, {attribution: cdblAttrib});
    var cdblnUrl='https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png';
    var cdblnAttrib='&copy; <a href="https://carto.com/">CARTO</a>';
    var cdbln = new L.TileLayer(cdblnUrl, {attribution: cdblnAttrib});
    var cdbdUrl='https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png';
    var cdbdAttrib='&copy; <a href="https://carto.com/">CARTO</a>';
    var cdbd = new L.TileLayer(cdbdUrl, {attribution: cdbdAttrib});

    var map = L.map('map').setView([47.493915, 19.062294], 13);
    L.control.scale().addTo(map);
    map.addLayer(tu);

    var baseMaps = [{
        groupName : "Térképek",
        layers    : {
            "Turistautak" : tu,
            "OpenStreetMap" : osm,
            "OpenTopoMap" : otm,
            "Thunderforest Landscape" : tf,
            "Thunderforest Pioneer" : tfp,
            "Thunderforest MobileAtlas" : tfm,
            "Esri Satellite" : esrisat,
            "Esri Topographic" : esrit,
            "Esri Street" : esris,
            "CyclOSM" : cyclo,
            "CartoDB Light" : cdbl,
            "CartoDB Light NoLabels" : cdbln,
            "CartoDB Dark" : cdbd,
            "TopPlusOpen Color" : tpoc,
            "TopPlusOpen Grey" : tpog
        }
    }];

// +++++ Itt definiáljuk a térképrétegek tömbjét a váltogatáshoz
    var layers = [tu, osm, otm, tf, tfp, tfm, esrisat, esrit, esris, cyclo, cdbl, cdbln, cdbd, tpoc, tpog];
    var currentLayerIndex = 0; // kezdetben tu van hozzáadva
    var intervalId; // intervallum azonosító a folyamatos váltogatáshoz
    var gpsMarker; // GPS marker

    // GPS pozíció lekérése
    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition, showError);
        } else {
            alert("Geolocation is not supported by this browser.");
        }
    }

    function showPosition(position) {
        var lat = position.coords.latitude;
        var lon = position.coords.longitude;
        var latlng = L.latLng(lat, lon);
        if (gpsMarker) {
            map.removeLayer(gpsMarker);
        }
        gpsMarker = L.marker(latlng).addTo(map).bindPopup("Saját pozíció");
        map.setView(latlng, 15);
    }

    function showError(error) {
        switch(error.code) {
            case error.PERMISSION_DENIED:
                alert("User denied the request for Geolocation.");
                break;
            case error.POSITION_UNAVAILABLE:
                alert("Location information is unavailable.");
                break;
            case error.TIMEOUT:
                alert("The request to get user location timed out.");
                break;
            case error.UNKNOWN_ERROR:
                alert("An unknown error occurred.");
                break;
        }
    }

// +++++ Itt hozzáadjuk a custom gombot a térképrétegek váltogatásához, amely megjeleníti az aktuális számot és fix szélességű
    L.control.custom({
        position: 'bottomright',
        content: '<div style="display: flex; flex-direction: column;"><div id="layerDisplay" style="width: 30px; background-color: white; border: 1px solid #ccc; padding: 5px; text-align: center; user-select: none;">1</div><button id="plusBtn" type="button" style="width: 30px; background-color: white; border: 1px solid #ccc; padding: 5px; cursor: pointer; user-select: none;">+</button><button id="minusBtn" type="button" style="width: 30px; background-color: white; border: 1px solid #ccc; padding: 5px; cursor: pointer; user-select: none;">-</button></div>',
        events: {
            click: function(event) {
                if (event.target.id === 'plusBtn') {
                    // növeli az indexet
                    map.removeLayer(layers[currentLayerIndex]);
                    currentLayerIndex = (currentLayerIndex + 1) % layers.length;
                    map.addLayer(layers[currentLayerIndex]);
                    document.getElementById('layerDisplay').innerText = currentLayerIndex + 1;
                } else if (event.target.id === 'minusBtn') {
                    // csökkenti az indexet
                    map.removeLayer(layers[currentLayerIndex]);
                    currentLayerIndex = (currentLayerIndex - 1 + layers.length) % layers.length;
                    map.addLayer(layers[currentLayerIndex]);
                    document.getElementById('layerDisplay').innerText = currentLayerIndex + 1;
                }
            },
            mousedown: function(event) {
                if (event.target.id === 'plusBtn') {
                    // elindítjuk az intervallumot növelésre
                    intervalId = setInterval(function() {
                        map.removeLayer(layers[currentLayerIndex]);
                        currentLayerIndex = (currentLayerIndex + 1) % layers.length;
                        map.addLayer(layers[currentLayerIndex]);
                        document.getElementById('layerDisplay').innerText = currentLayerIndex + 1;
                    }, 500);
                } else if (event.target.id === 'minusBtn') {
                    // elindítjuk az intervallumot csökkentésre
                    intervalId = setInterval(function() {
                        map.removeLayer(layers[currentLayerIndex]);
                        currentLayerIndex = (currentLayerIndex - 1 + layers.length) % layers.length;
                        map.addLayer(layers[currentLayerIndex]);
                        document.getElementById('layerDisplay').innerText = currentLayerIndex + 1;
                    }, 500);
                }
            },
            touchstart: function(event) {
                if (event.target.id === 'plusBtn') {
                    // elindítjuk az intervallumot növelésre, mobilhoz
                    intervalId = setInterval(function() {
                        map.removeLayer(layers[currentLayerIndex]);
                        currentLayerIndex = (currentLayerIndex + 1) % layers.length;
                        map.addLayer(layers[currentLayerIndex]);
                        document.getElementById('layerDisplay').innerText = currentLayerIndex + 1;
                    }, 500);
                } else if (event.target.id === 'minusBtn') {
                    // elindítjuk az intervallumot csökkentésre, mobilhoz
                    intervalId = setInterval(function() {
                        map.removeLayer(layers[currentLayerIndex]);
                        currentLayerIndex = (currentLayerIndex - 1 + layers.length) % layers.length;
                        map.addLayer(layers[currentLayerIndex]);
                        document.getElementById('layerDisplay').innerText = currentLayerIndex + 1;
                    }, 500);
                }
            },
            mouseup: function() {
                // megállítjuk az intervallumot
                clearInterval(intervalId);
            },
            touchend: function() {
                // megállítjuk az intervallumot, mobilhoz
                clearInterval(intervalId);
            },
            mouseleave: function() {
                // ha elhagyja a gombot, megállítjuk
                clearInterval(intervalId);
            },
            touchcancel: function() {
                // ha megszakad a touch, megállítjuk
                clearInterval(intervalId);
            }
        }
    }).addTo(map);

    // GPS gomb hozzáadása
    L.control.custom({
        position: 'bottomleft',
        content: '<button type="button" style="width: 30px; background-color: white; border: 1px solid #ccc; padding: 5px; cursor: pointer; user-select: none;">GPS</button>',
        events: {
            click: function() {
                getLocation();
            }
        }
    }).addTo(map);

</script>
  </body>
</html>
